<?php

namespace Lib\Http;

use FrameworkClass\Request;
use Lib\Router\Route;

class APIRequest extends Request
{
    /**
     * @var \Lib\Router\Route
     */
    private $route;

    /**
     * @var \Lib\Router\Route
     */
    private $body;

    /**
     * @return \Lib\Router\Route
     */
    public function getRoute()
    {
        return $this->route;
    }

    /**
     * @param \Lib\Router\Route $route La route associée à la requête
     *
     * @return \Lib\Http\APIRequest
     */
    public function setRoute(Route $route)
    {
        $this->route = $route;

        return $this;
    }

    public function getBaseURI()
    {
        if(false !== $pos = strpos($_SERVER['REQUEST_URI'], '?')) {
            return substr($_SERVER['REQUEST_URI'], 0, $pos);
        }

        return $_SERVER['REQUEST_URI'];
    }

    public function getBody(){
        if (empty($this->body)) {
            $this->body = file_get_contents("php://input");
        }

        return $this->body;

    }

    public function getJsonBody() {
        return json_decode($this->getBody(), true);
    }
}

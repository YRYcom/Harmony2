<?php
namespace FrameworkClass;

/**
 * Chargement automatique des classes en fonction du namespace
 * 
 */
class AutoLoader
{
    /**
     * Les informations sur les namespaces enregistres
     * 
     * @var array
     */
    static private $lesNamespaces = array();

    /**
     * Impossible d'instancier la classe
     * 
     * @return boolean
     */
    private function __construct()
    {
        return false;
    }
    
    /**
     * Enregistre la méthode load() dans la SPL
     */
    static public function run()
    {
        spl_autoload_register(array('self', 'load'));
    }

    /**
     * Enregistre les informations sur le chargement automatique d'un namespace
     * 
     * @param string $name Le nom du namespace
     * @param string $directory Le répertoire ou pointent le namespace
     * @param string $extension L'extension des fichiers dans le répertoire
     */
    static function addNamespace($name, $directory, $extension)
    {
        AutoLoader::$lesNamespaces[$name] = array('directory' => $directory, 'extension' => $extension);
    }

    /**
     * Retourne les informations d'un namespace
     * 
     * @param string $name
     * @return array
     */
    public static function getNamespace($name)
    {
        if (!array_key_exists($name , AutoLoader::$lesNamespaces))
            return false;

        return AutoLoader::$lesNamespaces[$name];
    }

    /**
     * Inclut la classe demandée ou retourne false si erreur
     * 
     * @param string $namespace
     * @return void
     */
    static private function load($namespace)
    {
        $splitpath = explode('\\', $namespace);
        if (count($splitpath) < 2) {
            return false;
        }

        $info = AutoLoader::getNamespace($splitpath[0]);
        if ($info === false)
            return false;

        $path = $info['directory'];
		//Ajut des dossiers
        $j=1;
        for($i=1; $i<(count($splitpath)-1); $i++) {
            $path .= '/'.strtolower($splitpath[$i]);
            $j++;
        }
        //Nom de la classe
        $path .= '/'.$splitpath[$j];

        $path .= '.'.$info['extension'];

        if (! file_exists($path))
          return false;

        include_once($path);
    }
}
